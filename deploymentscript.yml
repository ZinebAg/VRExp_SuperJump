name: â˜• SwisscomSuperJump CI/CD Pipeline

on:
  push:
    branches: 
      - main
    paths:
      - '**'
      - '.github/workflows/deployer.yml'
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'production'
        type: choice
        options:
          - production

# Cancel in-progress runs of the same workflow
concurrency:
  group: swisscomsuperjump-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # Deploy Website
  deploy-website:
    name: â˜• Deploy SwisscomSuperJump
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment || 'PRODUCTION' }}
    
    steps:
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“ List website files
        run: |
          echo "ğŸ“‚ Website files to deploy:"
          ls -la
          echo "ğŸ“Š Total files: $(find . -maxdepth 1 -type f | wc -l)"

      - name: â˜• SwisscomSuperJump
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: w00fff01.kasserver.com
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftp
          port: 21
          local-dir: ./
          server-dir: /
          exclude: |
            **/.git*
            **/.git*/**
            **/Untitled/**
            **/.github/**

      - name: âœ… Success Notification
        if: success()
        run: |
          echo "ğŸ‰ Coffee Manager Website deployment completed successfully!"
          echo "â˜• Website: https://swisscomsuperjump.ch"
          echo "ğŸ“… Deployed at: $(date)"

      - name: âŒ Failure Notification
        if: failure()
        run: |
          echo "âŒ Coffee Manager Website deployment failed!"
          echo "Please check the workflow logs for details."
          exit 1